"""NOTA IMPORTANTE LA BUSQUEDA DE LOS FORM ESTA EN LA PARTE TRES DE ESTA PRACTICA
Desarrollo: Parte 2 - Búsqueda de Formularios (Web Scraping)"""
import requests
import os
import mysql.connector as mysql
from bs4 import BeautifulSoup

# Inicio del código
print ("Python conectándose a MySQL")

# Conectándose a MySQL
conexion = mysql.connect( host='localhost', user= 'root', passwd='', db='compuservi' )
operacion = conexion.cursor()
operacion.execute( "select dir_ip from computadoras where servicio = 'http';" )
for dir_ip in operacion.fetchall() :
    print (dir_ip)
conexion.close()
ip = str(dir_ip[0])
print(str(ip))
print("-------------RESULTADOS--------------")
try:
    response = requests.get("http://"+ip)
    print("SE PUDO HACER LA CONEXION A LA COMPUTADORA: "+ ip)
    soup = BeautifulSoup(response.text, "lxml")
    print("---Estas son las Etiquetas FORM---")
    print(soup.form)
    print("---Estas son las Etiquetas HREF")

    arreglo = soup.find_all('a')
    i = 0
    for a in arreglo:
        print(a['href'])
        print ("Python conectándose a MySQL")
        conexion = mysql.connect( host='localhost', user= 'root', passwd='', db='compuservi')
        operacion = conexion.cursor()
        sql = "INSERT INTO enlaces (id_enlace, dir_ip, enlace) VALUES (0,'"+ip+"','"+a['href']+"')"
        operacion.execute(sql)
        conexion.commit()
        conexion.close()
        i=+1
except:
    print("Fallo la conexion")

"""NOTA IMPORTANTE LA BUSQUEDA DE LOS FORM ESTA EN LA PARTE TRES DE ESTA PRACTICA"""